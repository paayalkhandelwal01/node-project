"use strict";
exports.__esModule = true;
var promise_connect_flash_functions_1 = require("./promise-connect-flash-functions");
/**
 * use this function to initialize promise base of async-connect-flash after setting the session middleware
 * @param config this is the configuration of flashconnect
 * @returns a middleware
 */
var connectFlashPromise = function (config) {
    if (config === void 0) { config = {}; }
    return function (req, res, next) {
        var flashStore = config.storeProperty || "flash";
        if (!req.session[flashStore])
            req.session[flashStore] = {};
        if (!req.session)
            throw new Error("your should install express-session library!");
        if (!req.setFlash || !req.getFlash) {
            req.setFlash = function (key, value) {
                return (0, promise_connect_flash_functions_1.setFlashMessagePr)(req, key, value, config);
            };
            req.getFlash = function (key) {
                return (0, promise_connect_flash_functions_1.getFlashMessagePr)(req, key, config);
            };
        }
        next();
    };
};
exports["default"] = connectFlashPromise;
