"use strict";
exports.__esModule = true;
var callback_connect_flash_functions_1 = require("./callback-connect-flash-functions");
/**
 * use this function to initialize callback version of async-flash-connect after setting the session middleware
 * @param config the configuration object of flashconnect
 * @returns a middleware
 */
var connectFlashCallback = function (config) {
    if (config === void 0) { config = {}; }
    return function (req, res, next) {
        var flashStore = config.storeProperty || "flash";
        if (!req.session[flashStore])
            req.session[flashStore] = {};
        if (!req.session)
            throw new Error("your should install express-session library!");
        if (!req.setFlash || !req.getFlash) {
            req.setFlash = function (key, value, callback) {
                (0, callback_connect_flash_functions_1.setFlashMessageCb)(req, key, value, callback, config);
            };
            req.getFlash = function (key, callback) {
                (0, callback_connect_flash_functions_1.getFlashMessageCb)(req, key, callback, config);
            };
        }
        next();
    };
};
exports["default"] = connectFlashCallback;
